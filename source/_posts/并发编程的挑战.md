---
title: Jave - 一、并发编程的挑战 - Note
categories: 技术
tags:
  - 笔记
  - 并发
  - 多线程
  - 《Java并发编程的艺术》
date: 2018-01-11 23:12:44
---

### 概述
并发编程的目的是为了让程序运行的更快，但是，并不是启动更多的线程就能让程序最大限度的并发执行。如果希望通过多线程执行任务让程序运行的更快，会面临很多挑战。

### 挑战一：上下文切换
- 即使是单核处理器也支持多线程。CPU通过给每个线程分配`时间片`，因为`时间片`非常短（一般为几十毫秒），所以CPU通过不断地切换线程执行，使我们感觉多个线程是同时执行的。
- 在切换前会保存上一个任务的状态，以便下次切换回这个任务时，再加载这个任务的状态。任务从保存到再加载的过程就是一次`上下文切换`。`上下文切换`会影响多线程的执行速度。  
- ** 多线程一定快吗？ **  
通过代码测试发现，上述问题的答案是：**不一定**。当并发执行的次数很多，达到百万、千万级别时，才会相对较快。

### 挑战二：死锁

<!--more-->

- `锁`是一个非常有用的工具，运用场景非常多，因为它使用起来非常简单，而且易于理解。但同时它也会带来一些困扰，比如可能会引起`死锁`，一旦产生`死锁`，就会造成系统功能不可用。
- 避免死锁的几个常见方法：
  - 避免一个线程同时获得多个锁。
  - 避免一个线程在锁内同时占用多个资源，尽量保证每个锁只占用一个资源。
  - 尝试使用定时锁，使用`lock.tryLock(timeout)`来代替使用内部锁机制。
  - 对于数据库锁，加锁和解锁必须在一个数据库连接里，否则会出现解锁失败的情况。

### 挑战三：资源限制的挑战
- **什么是资源限制**  
`资源限制`：程序的执行速度受限于计算机硬件资源或软件资源。硬件资源限制有带宽的上传/下载速度、硬盘读写速度和CPU的处理速度。软件资源限制有数据库的连接数和socket连接数等。
- **资源限制引发的问题**  
并发时，将代码执行速度加快的原则是将代码中串行执行的部分变为并发执行，但如果由于资源受限，仍在串行执行，这是程序不但不会加快执行，反而会`更慢`，因为`增加了上下文切换和资源调度的时间`。
- **如何解决资源限制的问题**  
对于硬件资源限制，可以考虑使用集群并行执行程序，搭建服务器集群。对于软件资源限制，可以考虑使用资源池将资源复用，比如数据库连接池。
- **如何在资源限制的情况下，让程序执行的更快呢**  
根据不同的资源限制调整程序的并发度。


> 参考
>
> * 方鹏飞 - 《Java并发编程的艺术》
